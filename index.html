<!DOCTYPE html>
<html lang="en" class="scrollbar-gutter-stable">
<head>
    <!-- 1. PERFORMANCE: Preconnect to critical domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.tailwindcss.com">

    <!-- 2. SEO: Enhanced Structured Data (Schema Markup) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Prepogy",
      "url": "https://prepogy.in/",
      "description": "The ultimate CMA MCQ practice platform. Access authentic ICMAI previous year questions and chapter-wise mock tests for Syllabus 2022.",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://prepogy.in/?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <!-- Schema: Breadcrumb List -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://prepogy.in/"
      }]
    }
    </script>

    <!-- Schema: Organization with Social Links -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "Prepogy",
      "url": "https://prepogy.in/",
      "logo": "https://prepogy.in/prep.png",
      "sameAs": [
        "https://prepogy.in/",
        "https://www.instagram.com/prepogy.in/",
        "https://whatsapp.com/channel/0029Vb77tFDKQuJFr4fbCE3c"
      ],
      "description": "Tailored MCQ Practice Platform Exclusively for CMA Students (Syllabus 2022) featuring ICMAI previous year questions.",
      "audience": {
        "@type": "EducationalAudience",
        "educationalRole": "student"
      }
    }
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7792469883739877" crossorigin="anonymous"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FLGRHV6077"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-FLGRHV6077');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <!-- Theme Color for Mobile Browsers -->
    <meta name="theme-color" content="#6366f1">
    
    <!-- SEO & Primary Meta -->
    <title>Prepogy - CMA MCQ Bank, ICMAI Previous Year Questions & Mock Tests</title>
    <meta name="description" content="Free CMA MCQ practice platform for Syllabus 2022. Solve authentic ICMAI previous year questions (2013-2025) and chapter-wise mock tests for Foundation, Inter, and Final.">
    <meta name="keywords" content="CMA MCQ, ICMAI Previous Year Questions, CMA Inter MCQ, CMA Foundation Mock Test, CMA Final Questions, ICMAI Syllabus 2022, Cost and Management Accountant">
    
    <link rel="canonical" href="https://prepogy.in/">
    <link rel="icon" href="prep.png" type="image/png">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'" fetchpriority="low">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></noscript>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins', 'sans-serif'] },
                    colors: {
                        primary: { DEFAULT: '#6366f1', dark: '#4f46e5' },
                        success: '#10b981', error: '#ef4444', surface: '#ffffff',
                        sjc: '#036176',
                    },
                    boxShadow: {
                        soft: '0 10px 40px -10px rgba(0,0,0,0.06)',
                        hover: '0 20px 40px -5px rgba(99, 102, 241, 0.12)',
                    },
                    animation: {
                        'rise': 'rise 20s linear infinite',
                        'floating': 'floating 4s ease-in-out infinite',
                        'bounce-subtle': 'subtle-bounce 0.6s ease infinite',
                        'fade-in-up': 'fadeInUp 0.3s ease forwards',
                        'rotate-border': 'rotate-border 3s linear infinite',
                        'shimmer': 'shimmer 4s infinite',
                        'pulse-soft': 'pulse-soft 3s ease-in-out infinite',
                        'glow-purple': 'glow-purple 2.5s ease-in-out infinite',
                    },
                    keyframes: {
                        rise: { 'from': { transform: 'translateY(0) rotate(0deg)', opacity: '0.4' }, 'to': { transform: 'translateY(-120vh) rotate(360deg)', opacity: '0' } },
                        floating: { '0%, 100%': { transform: 'translateY(0px)' }, '50%': { transform: 'translateY(-12px)' } },
                        'subtle-bounce': { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-3px)' } },
                        fadeInUp: { 'from': { opacity: '0', transform: 'translateY(10px)' }, 'to': { opacity: '1', transform: 'translateY(0)' } },
                        'rotate-border': { 'from': { transform: 'rotate(0deg)' }, 'to': { transform: 'rotate(360deg)' } },
                        shimmer: { '0%': { transform: 'translateX(-150%)' }, '100%': { transform: 'translateX(150%)' } },
                        'pulse-soft': { '0%, 100%': { transform: 'scale(1)', opacity: '1' }, '50%': { transform: 'scale(1.015)', opacity: '0.95' } },
                        'glow-purple': {
                            '0%, 100%': { color: '#B201E3', textShadow: '0 0 8px rgba(178, 1, 227, 0.4)' },
                            '50%': { color: '#5C01E3', textShadow: '0 0 12px rgba(92, 1, 227, 0.6)' }
                        }
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
            .text-gradient-original { @apply bg-clip-text text-transparent bg-[linear-gradient(135deg,#10b981,#6366f1,#db2777,#f59e0b)]; }
            .scrollbar-gutter-stable { scrollbar-gutter: stable; }
            /* Google G Stylized Letter */
            .google-g-text {
                background: conic-gradient(
                    #4285f4 0deg 90deg, 
                    #34a853 90deg 180deg, 
                    #fbbc05 180deg 270deg, 
                    #ea4335 270deg 360deg
                );
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                @apply font-black;
            }
        }

        @layer components {
            .view-section { @apply hidden opacity-0 translate-y-4 transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] max-w-6xl mx-auto px-5 pb-20 w-full; }
            .view-section.active { @apply block opacity-100 translate-y-0; }
            .view-section.preparing { @apply block; }
            .card-base {
                @apply border-[3px] border-transparent rounded-[28px] p-10 text-center cursor-pointer 
                       transition-all duration-300 shadow-soft relative overflow-hidden bg-white hover:-translate-y-2;
                background-origin: padding-box, border-box;
                background-clip: padding-box, border-box;
            }
            .choice-card { @apply card-base; }
            .subject-card { @apply card-base; }
            .card-foundation, .subj-foundation { background-image: linear-gradient(white, white), linear-gradient(135deg, #10b981, #0ea5e9); }
            .card-inter, .subj-inter, .mode-bank { background-image: linear-gradient(white, white), linear-gradient(135deg, #6366f1, #a855f7); }
            .card-final, .subj-final, .mode-pyq { background-image: linear-gradient(white, white), linear-gradient(135deg, #f59e0b, #db2777); }
            .mode-sjc { background-image: linear-gradient(white, white), linear-gradient(135deg, #036176, #024a5a); }
            .option {
                @apply flex items-center p-3 md:p-5 mb-3 bg-white border border-slate-200 rounded-2xl 
                       cursor-pointer transition-all duration-200 hover:scale-[1.015] hover:translate-x-1 hover:bg-violet-50 hover:shadow-hover hover:border-primary;
            }
            .option.disabled { @apply pointer-events-none; }
            .option.correct { @apply border-success bg-emerald-50; }
            .option.incorrect { @apply border-error bg-red-50; }
            .shape { @apply absolute bottom-[-150px] opacity-15 font-bold block will-change-transform animate-rise; line-height: 1; }
        }
    </style>
</head>
<body class="font-sans bg-slate-50 text-gray-800 overflow-x-hidden antialiased min-h-screen flex flex-col">

    <!-- Background Shapes -->
    <div class="fixed inset-0 w-full h-full pointer-events-none -z-10 overflow-hidden select-none" aria-hidden="true">
        <div class="shape left-[10%] text-[55px] text-emerald-500" style="animation-duration: 22s; animation-delay: -2s;">‚Çπ</div>
        <div class="shape left-[20%] text-[45px] text-indigo-500" style="animation-duration: 18s; animation-delay: -5s;">$</div>
        <div class="shape left-[35%] text-[50px] text-pink-600" style="animation-duration: 25s; animation-delay: -7s;">‚Çπ</div>
        <div class="shape left-[50%] text-[55px] text-amber-500" style="animation-duration: 20s; animation-delay: -3s;">‚Ç¨</div>
        <div class="shape left-[65%] text-[45px] text-emerald-500" style="animation-duration: 15s; animation-delay: -10s;">‚Çπ</div>
        <div class="shape left-[80%] text-[65px] text-indigo-500" style="animation-duration: 28s; animation-delay: -1s;">√ó</div>
        <div class="shape left-[90%] text-[50px] text-pink-600" style="animation-duration: 23s; animation-delay: -12s;">√∑</div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col-reverse gap-3">
        <button class="w-12 h-12 rounded-full bg-white border-2 border-slate-200 flex items-center justify-center text-slate-500 hover:bg-primary hover:text-white hover:border-transparent transition-all shadow-sm hidden md:flex" id="btnShortcuts" aria-label="Keyboard Shortcuts"><i class="fas fa-keyboard"></i></button>
        <button class="w-12 h-12 rounded-full bg-white border-2 border-slate-200 flex items-center justify-center text-slate-500 hover:bg-primary hover:text-white hover:border-transparent transition-all shadow-sm" onclick="App.view.navigateTo('view-about')" aria-label="About Prepogy"><i class="fas fa-info-circle"></i></button>
    </div>

    <!-- Shortcuts Modal -->
    <div id="shortcutsModal" class="hidden fixed inset-0 z-[2000] bg-black/60 backdrop-blur-sm items-center justify-center p-5 [&.show]:flex">
        <div class="bg-white p-8 rounded-3xl w-full max-w-[500px] animate-fade-in-up relative shadow-2xl">
            <button class="absolute top-4 right-4 text-2xl font-bold text-gray-300 hover:text-gray-500 transition-colors" onclick="App.toggleShortcuts(false)">&times;</button>
            <h2 class="text-xl font-bold text-primary mb-4 flex items-center gap-2"><i class="fas fa-keyboard"></i> Shortcuts</h2>
            <ul class="space-y-3 text-sm md:text-base">
                <li class="flex justify-between border-b border-slate-100 pb-2"><span>Select Option</span> <span class="font-bold font-mono bg-slate-100 px-2 py-0.5 rounded text-xs">A/B/C/D</span></li>
                <li class="flex justify-between border-b border-slate-100 pb-2"><span>Next Question</span> <span class="font-bold font-mono bg-slate-100 px-2 py-0.5 rounded text-xs">Enter / ‚Üí</span></li>
                <li class="flex justify-between"><span>Back / Previous</span> <span class="font-bold font-mono bg-slate-100 px-2 py-0.5 rounded text-xs">Esc / ‚Üê</span></li>
            </ul>
        </div>
    </div>

    <!-- SJC Introduction Modal -->
    <div id="sjcIntroModal" class="hidden fixed inset-0 z-[2000] bg-black/60 backdrop-blur-md items-center justify-center p-5 [&.show]:flex">
        <div class="bg-white p-8 md:p-10 rounded-[40px] w-full max-w-[600px] animate-fade-in-up relative shadow-2xl overflow-hidden">
            <button class="absolute top-6 right-6 text-2xl font-bold text-gray-300 hover:text-gray-500 transition-colors z-20" onclick="App.toggleSjcModal(false)" aria-label="Close">&times;</button>
            <div class="absolute -top-10 -left-10 w-32 h-32 bg-[#036176]/5 rounded-full"></div>
            <div class="relative z-10 text-center">
                <div class="w-16 h-16 bg-[#036176] text-white font-bold rounded-2xl flex items-center justify-center text-2xl mx-auto mb-6 shadow-lg shadow-cyan-900/20">SJC</div>
                <h3 class="text-xl font-extrabold text-gray-800 mb-4 leading-tight">About SJC Institute</h3>
                <p class="text-slate-600 text-sm md:text-base leading-relaxed mb-6">
                    This MCQ quiz is based on materials from the SJC Institute, one of the oldest institutions supporting CMA students. Their workshops and webinars are very helpful, and they continue to guide students even if they face setbacks.
                </p>
                <div class="bg-indigo-50/50 p-6 rounded-[28px] border border-indigo-100 mb-8">
                    <p class="text-xs md:text-sm font-semibold text-indigo-600 mb-4">üì∫ It's recommended to try this quiz while watching the accompanying video for the best results.</p>
                    <a href="https://www.youtube.com/watch?v=QkVVoCPjLFU&list=PLM5Q5CSb57Q3NQaygJcRa7DoK3CnwUBFF" target="_blank" class="flex items-center justify-center gap-3 bg-white p-4 rounded-2xl shadow-sm border border-indigo-50 hover:border-primary group transition-all">
                        <i class="fab fa-youtube text-red-600 text-2xl group-hover:scale-110 transition-transform"></i>
                        <div class="text-left">
                            <span class="block text-[10px] uppercase font-bold text-slate-400">Watch Workshop</span>
                            <span class="block text-xs md:text-sm font-bold text-slate-700">Costing MCQ Mastery Class</span>
                        </div>
                    </a>
                </div>
                <button onclick="App.toggleSjcModal(false); App.quiz.startQuizSession('sjc');" class="w-full py-4 bg-[#036176] text-white rounded-2xl font-bold shadow-lg shadow-cyan-900/20 hover:brightness-110 hover:-translate-y-0.5 transition-all">
                    Start Quiz Now
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="globalLoader" class="fixed inset-0 bg-white/95 z-[3000] hidden flex-col items-center justify-center transition-all">
        <div class="w-12 h-12 border-[5px] border-indigo-100 border-t-primary rounded-full animate-spin"></div>
        <p class="mt-4 font-bold text-primary tracking-tight animate-pulse">Accessing Prepogy Bank...</p>
    </div>

    <!-- Header -->
    <header class="text-center py-10 md:py-16 px-5 relative shrink-0">
        <div class="w-24 h-24 md:w-36 md:h-36 mx-auto mb-5 cursor-pointer transition-all duration-300 hover:scale-110 drop-shadow-lg flex items-center justify-center animate-floating" id="logoHome" role="button">
            <img src="prep.png" alt="Prepogy Logo" width="144" height="144" class="w-full h-auto object-contain" fetchpriority="high" onerror="this.src='https://via.placeholder.com/150?text=P'">
        </div>
        <h1 class="text-[clamp(2rem,6vw,3.5rem)] font-extrabold uppercase tracking-[2px] text-gradient-original mb-1">Prepogy</h1>
        <p class="text-[0.9em] text-slate-500 font-medium tracking-wide mt-1">Tailored MCQ Practice Exclusively for CMA Students</p>
    </header>

    <main id="app" class="flex-grow flex flex-col relative w-full">
        <!-- 1. HOME -->
        <section id="view-home" class="view-section active">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="choice-card card-foundation group" onclick="App.view.navigateTo('view-foundation')">
                    <i class="fas fa-seedling text-4xl text-emerald-500 mb-4 block group-hover:scale-110 transition-transform"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Foundation</h2>
                    <p class="text-gray-400 text-sm mt-1">Level 1 | Papers 1 - 4</p>
                </div>
                <div class="choice-card card-inter group" onclick="App.view.navigateTo('view-inter')">
                    <i class="fas fa-graduation-cap text-4xl text-indigo-500 mb-4 block group-hover:scale-110 transition-transform"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Intermediate</h2>
                    <p class="text-gray-400 text-sm mt-1">Level 2 | Papers 5 - 12</p>
                </div>
                <div class="choice-card card-final group" onclick="App.view.navigateTo('view-final')">
                    <i class="fas fa-trophy text-4xl text-amber-500 mb-4 block group-hover:scale-110 transition-transform"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Final</h2>
                    <p class="text-gray-400 text-sm mt-1">Level 3 | Papers 13 - 20</p>
                </div>
            </div>
        </section>

        <!-- 2. INTER SUB-GROUP -->
        <section id="view-inter" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-primary bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md border border-slate-100" onclick="App.view.goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-2xl mx-auto">
                <div class="choice-card card-inter group" onclick="App.view.renderSubjects('interG1', 'Group I', 'subj-inter')">
                    <h2 class="text-xl font-bold group-hover:text-indigo-600 transition-colors">Group I</h2>
                    <p class="text-xs text-gray-400 mt-2">Papers 5 - 8</p>
                </div>
                <div class="choice-card card-inter group" onclick="App.view.renderSubjects('interG2', 'Group II', 'subj-inter')">
                    <h2 class="text-xl font-bold group-hover:text-indigo-600 transition-colors">Group II</h2>
                    <p class="text-xs text-gray-400 mt-2">Papers 9 - 12</p>
                </div>
            </div>
        </section>

        <!-- 3. FINAL SUB-GROUP -->
        <section id="view-final" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-amber-600 bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md border border-slate-100" onclick="App.view.goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-2xl mx-auto">
                <div class="choice-card card-final group" onclick="App.view.renderSubjects('finalG3', 'Group III', 'subj-final')">
                    <h2 class="text-xl font-bold group-hover:text-amber-600 transition-colors">Group III</h2>
                    <p class="text-xs text-gray-400 mt-2">Papers 13 - 16</p>
                </div>
                <div class="choice-card card-final group" onclick="App.view.renderSubjects('finalG4', 'Group IV', 'subj-final')">
                    <h2 class="text-xl font-bold group-hover:text-amber-600 transition-colors">Group IV</h2>
                    <p class="text-xs text-gray-400 mt-2">Papers 17 - 20</p>
                </div>
            </div>
        </section>

        <!-- 4. FOUNDATION LIST -->
        <section id="view-foundation" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-emerald-600 bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md border border-slate-100" onclick="App.view.goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <div id="foundationList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </section>

        <!-- 5. SUBJECTS LIST -->
        <section id="view-subjects" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-slate-600 bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md border border-slate-100" onclick="App.view.goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <h2 id="subjectsTitle" class="text-2xl font-bold text-center mb-8 text-slate-700">Subjects</h2>
            <div id="subjectsList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </section>

        <!-- 6. PRACTICE DASHBOARD -->
        <section id="view-dashboard" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-slate-600 bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md border border-slate-100" onclick="App.view.goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <h2 id="dashTitle" class="text-2xl font-bold text-center mb-8 text-slate-700">Practice Mode</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="dashboardGrid">
                <div class="subject-card mode-bank flex items-center gap-5 text-left p-6" onclick="App.quiz.startQuizSession('bm')">
                    <div class="w-14 h-14 rounded-2xl bg-slate-50 flex items-center justify-center shrink-0 text-2xl text-primary"><i class="fas fa-university"></i></div>
                    <div><h3 class="font-bold text-lg">Official MCQ Bank</h3><p class="text-xs text-slate-400">Syllabus 2022</p></div>
                </div>
                <div class="subject-card mode-pyq flex items-center gap-5 text-left p-6" onclick="App.quiz.startQuizSession('sw')">
                    <div class="w-14 h-14 rounded-2xl bg-slate-50 flex items-center justify-center shrink-0 text-2xl text-amber-500"><i class="fas fa-file-invoice"></i></div>
                    <div><h3 class="font-bold text-lg">Exam Papers</h3><p class="text-xs text-slate-400">Previous Year Questions</p></div>
                </div>
                <!-- SJC Custom Quiz Card -->
                <div id="cardSjc" class="subject-card mode-sjc flex items-center gap-5 text-left p-6 hidden" onclick="App.toggleSjcModal(true)">
                    <div class="w-14 h-14 rounded-2xl bg-[#036176] text-white font-bold flex items-center justify-center shrink-0 shadow-inner">SJC</div>
                    <div>
                        <h3 class="font-bold text-lg">Chapter wise Quiz</h3>
                        <p class="text-[10px] text-slate-400 font-bold">by Satish Jalan Sir</p>
                    </div>
                </div>
                <div id="cardLibrary" class="subject-card flex items-center gap-5 text-left p-6 opacity-60 grayscale cursor-not-allowed bg-slate-50 border-slate-200 pointer-events-none">
                    <div class="w-14 h-14 rounded-2xl bg-slate-100 flex items-center justify-center shrink-0 text-2xl text-slate-400"><i class="fas fa-book-open"></i></div>
                    <div><h3 class="font-bold text-lg text-slate-500">Library Section</h3><p class="text-[10px] text-slate-400 font-bold italic">Coming soon</p></div>
                </div>
            </div>
        </section>

        <!-- 7. QUIZ INTERFACE -->
        <section id="view-quiz" class="view-section">
            <div class="max-w-2xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <button class="bg-white border border-slate-200 px-4 py-2 rounded-full shadow-sm text-slate-500 font-bold text-xs" onclick="App.view.goBack()">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <div class="flex items-center gap-3">
                        <button onclick="App.quiz.resetLocalProgress()" class="text-[10px] text-red-400 font-bold uppercase tracking-wide">Reset</button>
                        <select id="setSelector" class="max-w-[140px] md:max-w-[220px] bg-white rounded-xl px-4 py-2 text-xs font-bold border border-slate-200 shadow-sm outline-none focus:border-primary text-slate-600 cursor-pointer truncate"></select>
                    </div>
                </div>
                
                <div class="bg-white rounded-3xl p-4 flex shadow-sm mb-8 border border-slate-100 divide-x divide-slate-100">
                    <div class="flex-1 text-center"><span class="block text-xl md:text-2xl font-extrabold text-emerald-500 mb-1" id="scoreCorrect">0</span><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Correct</span></div>
                    <div class="flex-1 text-center"><span class="block text-xl md:text-2xl font-extrabold text-red-500 mb-1" id="scoreWrong">0</span><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Wrong</span></div>
                    <div class="flex-1 text-center"><span class="block text-xl md:text-2xl font-extrabold text-primary mb-1" id="scoreAcc">0%</span><span class="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Accuracy</span></div>
                </div>

                <div id="questionArea" class="bg-white/95 backdrop-blur-md shadow-soft rounded-[28px] p-6 md:p-10 relative overflow-hidden transition-all duration-300">
                    <i class="fas fa-pen-nib absolute -bottom-6 -right-6 text-[14rem] text-primary opacity-[0.03] -rotate-12 pointer-events-none"></i>
                    <p id="qIndexDisplay" class="text-[10px] font-bold text-primary uppercase mb-4 relative z-10 tracking-widest"></p>
                    <h2 id="qTextDisplay" class="text-lg md:text-xl font-bold text-gray-800 mb-8 leading-relaxed relative z-10"></h2>
                    <div id="optionsContainer" class="space-y-3 relative z-10"></div>
                    
                    <div id="explanationContainer" class="relative z-10 mt-6 p-5 bg-slate-50 rounded-2xl border-l-4 border-primary hidden animate-fade-in-up">
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-xs font-bold uppercase text-primary tracking-wide">Explanation</h4>
                            <!-- ASK GURU G Button -->
                            <button id="btnAiExplain" onclick="App.quiz.openGoogleSearchExplanation()" class="relative p-[1.5px] rounded-full overflow-hidden inline-flex items-center justify-center cursor-pointer transition-transform hover:scale-105 shadow-sm group border-none bg-transparent" aria-label="Ask Guru G">
                                <div class="absolute inset-0 bg-[conic-gradient(from_0deg,#4285f4,#34a853,#fbbc05,#ea4335,#4285f4)] animate-rotate-border"></div>
                                <div class="relative bg-white px-3 py-1.5 rounded-full flex items-center gap-1.5 z-10">
                                    <i class="fas fa-magnifying-glass-chart text-primary text-xs"></i>
                                    <span class="font-bold text-[10px] text-slate-600">ASK GURU <span class="google-g-text">G</span></span>
                                </div>
                            </button>
                        </div>
                        <p id="explanationText" class="text-sm text-slate-600 leading-relaxed"></p>
                    </div>

                    <!-- MOBILE SWIPE GESTURE GUIDE: Now Glowing in #B201E3 and #5C01E3 -->
                    <div class="md:hidden flex justify-center items-center gap-2 text-[8px] font-bold uppercase tracking-[0.2em] mt-8 pt-4 border-t border-slate-100 animate-glow-purple relative z-10">
                        <i class="fas fa-left-right"></i>
                        <span>Swipe to navigate</span>
                    </div>

                    <div class="flex justify-between mt-6 md:mt-10 pt-6 relative z-10">
                        <button id="btnPrevQ" class="px-6 py-3 rounded-2xl font-bold transition-all flex items-center gap-2 bg-white border border-slate-200 text-slate-500 hover:bg-slate-50 invisible">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button id="btnNextQ" class="px-6 py-3 rounded-2xl font-bold transition-all flex items-center gap-2 bg-primary text-white shadow-lg shadow-indigo-200">
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <div id="resultsArea" class="hidden bg-white rounded-[28px] p-6 md:p-10 text-center shadow-xl animate-fade-in-up">
                    <h2 class="text-2xl md:text-3xl font-black text-primary mb-2">Quiz Finished!</h2>
                    <div id="finalScoreDisplay" class="text-lg md:text-xl font-bold mb-6 text-slate-500"></div>
                    <div class="relative overflow-hidden bg-gradient-to-br from-indigo-500 via-purple-500 to-emerald-500 p-[2px] rounded-[32px] mb-8 animate-pulse-soft">
                        <div class="bg-white rounded-[30px] p-6 md:p-8 relative overflow-hidden">
                            <h3 class="text-lg font-extrabold text-gray-800 mb-4 relative z-10">Share & Help Others Learn üìö</h3>
                            <div id="quoteDisplay" class="text-slate-600 font-medium mb-8 text-sm italic min-h-[3rem] flex items-center justify-center"></div>
                            <div class="grid grid-cols-3 gap-3 md:gap-6 relative z-10">
                                <button id="btnShareWA" class="group flex flex-col items-center gap-2 transition-transform duration-200 hover:scale-[1.03]">
                                    <div class="w-14 h-14 md:w-16 md:h-16 rounded-2xl flex items-center justify-center text-white text-2xl shadow-lg bg-[#25D366] transition-all hover:scale-110 group-hover:shadow-green-200"><i class="fab fa-whatsapp"></i></div>
                                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-tight">WhatsApp</span>
                                </button>
                                <button id="btnShareTG" class="group flex flex-col items-center gap-2 transition-transform duration-200 hover:scale-[1.03]">
                                    <div class="w-14 h-14 md:w-16 md:h-16 rounded-2xl flex items-center justify-center text-white text-2xl shadow-lg bg-[#0088cc] transition-all hover:scale-110 group-hover:shadow-blue-200"><i class="fab fa-telegram-plane"></i></div>
                                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-tight">Telegram</span>
                                </button>
                                <button id="btnShareCopy" class="group flex flex-col items-center gap-2 transition-transform duration-200 hover:scale-[1.03]">
                                    <div class="w-14 h-14 md:w-16 md:h-16 rounded-2xl flex items-center justify-center text-white text-2xl shadow-lg bg-slate-700 transition-all hover:scale-110 group-hover:shadow-slate-300"><i class="fas fa-link"></i></div>
                                    <span class="text-[10px] font-bold text-slate-500 uppercase tracking-tight">Copy Link</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="App.quiz.loadSet(App.quiz.state.currentSetIdx)" class="bg-primary text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-primary-dark transition-colors">Try Again</button>
                        <button onclick="App.view.resetToHome()" class="bg-slate-100 text-slate-500 py-4 rounded-2xl font-bold hover:bg-slate-200 transition-colors">Main Menu</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- STATIC PAGES: Full Content -->
        <section id="view-about" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-slate-600 bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md hover:bg-slate-700 hover:text-white transition-all border border-slate-100" onclick="App.view.resetToHome()" aria-label="Go Back"><i class="fas fa-arrow-left"></i> Back</button>
            <div class="bg-white p-8 md:p-12 rounded-[32px] shadow-xl leading-relaxed max-w-4xl mx-auto">
                <h2 class="text-3xl font-extrabold mb-8 text-primary flex items-center gap-3">üìö About Prepogy</h2>
                <div class="space-y-6 text-slate-700">
                    <p class="text-lg font-medium">My motivation for creating this website is to provide CMA students with an easy and effective way to prepare for their exams. üéØ</p>
                    <div class="bg-indigo-50 p-6 rounded-2xl border-l-4 border-primary">
                        <p class="italic text-slate-600 text-sm md:text-base">"The idea sparked back in 2019 while I was preparing for my driving license test‚Äîa computer-based MCQ exam at the RTO. üöóüíª I downloaded an app, attempted all 200 questions in one go, and despite making mistakes, the instant learning process was incredibly effective. That experience inspired me to build this platform for you! üí°‚ú®"</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                        <div class="p-6 bg-emerald-50 rounded-2xl border border-emerald-100">
                            <h3 class="font-bold text-emerald-700 mb-2 flex items-center gap-2"><i class="fas fa-check-circle"></i> Authentic Content</h3>
                            <p class="text-sm">All questions are sourced directly from the official <strong>CMA Institute MCQ bank</strong>.</p>
                        </div>
                        <div class="p-6 bg-blue-50 rounded-2xl border border-blue-100">
                            <h3 class="font-bold text-blue-700 mb-2 flex items-center gap-2"><i class="fas fa-rocket"></i> Targeted Success</h3>
                            <p class="text-sm">Focus on Syllabus 2022 and Previous Year Questions (2013-2025).</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="view-privacy" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-slate-600 bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md hover:bg-slate-700 hover:text-white transition-all border border-slate-100" onclick="App.view.resetToHome()" aria-label="Go Back"><i class="fas fa-arrow-left"></i> Back</button>
            <div class="bg-white p-8 md:p-12 rounded-[32px] shadow-lg max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold mb-6 text-emerald-600">üõ°Ô∏è Privacy Policy</h2>
                <div class="space-y-6 text-slate-600 text-sm leading-relaxed">
                    <p>At Prepogy.in, one of our main priorities is the privacy of our visitors. We do not require registration or personal accounts to use our services.</p>
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2 border-l-4 border-primary pl-3">1. Information We Collect</h3>
                        <p>Prepogy is designed to be a "privacy-first" platform. We do not store personal student identifiers like phone numbers or emails. Your progress is saved locally on your device.</p>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2 border-l-4 border-primary pl-3">2. Cookies</h3>
                        <p>We use standard analytics and ad-serving cookies to maintain site performance and support our educational mission. These help us understand which topics students find most helpful.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-terms" class="view-section">
            <button class="mb-8 font-bold flex items-center gap-2 text-slate-600 bg-white px-6 py-2.5 rounded-full shadow-sm hover:shadow-md hover:bg-slate-700 hover:text-white transition-all border border-slate-100" onclick="App.view.resetToHome()" aria-label="Go Back"><i class="fas fa-arrow-left"></i> Back</button>
            <div class="bg-white p-8 md:p-12 rounded-[32px] shadow-lg max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold mb-6 text-amber-600">üìú Terms and Conditions</h2>
                <div class="space-y-6 text-slate-600 text-sm leading-relaxed">
                    <p>Welcome to Prepogy. These terms outline the rules for using our practice platform.</p>
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2 border-l-4 border-primary pl-3">1. Property Rights</h3>
                        <p>All educational MCQs and syllabus data are sourced from official ICMAI public materials for fair educational use. Prepogy claims no ownership over the question bank itself.</p>
                    </div>
                    <div>
                        <h3 class="font-bold text-lg text-slate-800 mb-2 border-l-4 border-primary pl-3">2. Disclaimer</h3>
                        <p>The content provided is for practice and self-assessment purposes. While we strive for accuracy, students should always consult official study modules for final exam preparation.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="py-10 text-center shrink-0">
        <div class="flex justify-center gap-6 mb-8">
            <a href="https://whatsapp.com/channel/0029Vb77tFDKQuJFr4fbCE3c" target="_blank" class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center transition-all hover:-translate-y-1 hover:bg-[#25D366] group" aria-label="Join WhatsApp Channel">
                <i class="fab fa-whatsapp text-xl text-slate-400 group-hover:text-white"></i>
            </a>
            <a href="https://www.instagram.com/prepogy.in/" target="_blank" class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center transition-all hover:-translate-y-1 hover:bg-[#E1306C] group" aria-label="Follow on Instagram">
                <i class="fab fa-instagram text-xl text-slate-400 group-hover:text-white"></i>
            </a>
        </div>
        <div class="flex justify-center gap-6 mb-4 text-xs font-bold uppercase tracking-widest text-slate-400">
            <a href="#about" class="cursor-pointer hover:text-primary transition-colors no-underline text-slate-400" onclick="event.preventDefault(); App.view.navigateTo('view-about')" tabindex="0">About</a>
            <a href="#privacy" class="cursor-pointer hover:text-emerald-500 transition-colors no-underline text-slate-400" onclick="event.preventDefault(); App.view.navigateTo('view-privacy')" tabindex="0">Privacy</a>
            <a href="#terms" class="cursor-pointer hover:text-amber-600 transition-colors no-underline text-slate-400" onclick="event.preventDefault(); App.view.navigateTo('view-terms')" tabindex="0">Terms</a>
        </div>
        <p class="text-slate-400 text-xs font-bold mb-2">Prepogy ¬© 2025</p>
        <p class="text-sm font-bold text-emerald-500 mt-4 flex items-center justify-center gap-2">
            ‡§ú‡§Ø ‡§π‡§ø‡§®‡•ç‡§¶ <img src="https://upload.wikimedia.org/wikipedia/en/4/41/Flag_of_India.svg" alt="Flag of India" width="20" height="13" class="w-5 rounded-[2px] shadow-sm" loading="lazy">
        </p>
    </footer>

    <script>
        const Config = {
            baseTitle: "Prepogy - CMA MCQ Bank, ICMAI Previous Year Questions & Mock Tests",
            baseDesc: "Free CMA MCQ practice platform. Solve authentic ICMAI previous year questions (2013-2025) and chapter-wise mock tests for Foundation, Inter, and Final (Syllabus 2022).",
            syllabus: {
                foundation: [
                    {id:1,t:"P1: Business Laws", i:"fa-gavel", c:"text-emerald-500"},
                    {id:2,t:"P2: Accounting", i:"fa-calculator", c:"text-blue-500"},
                    {id:3,t:"P3: Maths & Stats", i:"fa-chart-line", c:"text-indigo-500"},
                    {id:4,t:"P4: Economics", i:"fa-globe", c:"text-cyan-500"}
                ],
                interG1: [
                    {id:5,t:"P5: Law & Ethics", i:"fa-scale-balanced", c:"text-indigo-600"},
                    {id:6,t:"P6: Fin. Accounting", i:"fa-book", c:"text-blue-600"},
                    {id:7,t:"P7: Taxation", i:"fa-receipt", c:"text-red-500"},
                    {id:8,t:"P8: Cost Account", i:"fa-coins", c:"text-emerald-600"}
                ],
                interG2: [
                    {id:9,t:"P9: OMSM", i:"fa-cogs", c:"text-gray-600"},
                    {id:10,t:"P10: Audit", i:"fa-clipboard-check", c:"text-cyan-600"},
                    {id:11,t:"P11: FMDA", i:"fa-chart-pie", c:"text-blue-400"},
                    {id:12,t:"P12: Mgmt Account", i:"fa-laptop-code", c:"text-purple-600"}
                ],
                finalG3: [
                    {id:13,t:"P13: Corp Laws", i:"fa-building-columns", c:"text-amber-700"},
                    {id:14,t:"P14: SFM", i:"fa-chart-area", c:"text-emerald-500"},
                    {id:15,t:"P15: DT & IT", i:"fa-earth-americas", c:"text-red-600"},
                    {id:16,t:"P16: SCM", i:"fa-bullseye", c:"text-blue-700"}
                ],
                finalG4: [
                    {id:17,t:"P17: Cost Audit", i:"fa-certificate", c:"text-orange-500"},
                    {id:18,t:"P18: CFR", i:"fa-file-invoice-dollar", c:"text-blue-800"},
                    {id:19,t:"P19: Indirect Tax", i:"fa-truck-fast", c:"text-red-400"},
                    {id:'20A',t:"P20A: SPMBV", i:"fa-rocket", c:"text-pink-600"},
                    {id:'20B',t:"P20B: Risk Mgmt", i:"fa-chess-knight", c:"text-violet-500"},
                    {id:'20C',t:"P20C: International Taxation", i:"fa-plane-departure", c:"text-emerald-500"}
                ]
            },
            quotes: [
                "Knowledge grows when shared. Help a friend prepare better üìö",
                "Your share helps keep Prepogy free and improving üöÄ",
                "If this helped you, it can help someone else too. Share it!",
                "Learning is better together. Invite your friends üë•",
                "Your support through sharing helps us add more MCQs faster üíô",
                "One share = one more student prepared better üéØ",
                "Exams are tough ‚Äî sharing good resources makes them easier.",
                "Help Prepogy grow so we can keep helping CMA students.",
                "Don‚Äôt keep good resources to yourself ‚Äî share the knowledge!",
                "Your share directly supports maintenance and future features ‚öôÔ∏è"
            ]
        };

        class ViewManager {
            constructor() {
                this.currentViewId = 'view-home';
                window.addEventListener('popstate', (e) => this.showView(e.state ? e.state.viewId : 'view-home'));
            }
            navigateTo(viewId) { history.pushState({ viewId: viewId }, '', ''); this.showView(viewId); }
            goBack() { history.back(); }
            resetToHome() { this.navigateTo('view-home'); }
            showView(viewId) {
                const current = document.getElementById(this.currentViewId);
                const next = document.getElementById(viewId);
                if (current) current.classList.remove('active');
                if (next) {
                    next.classList.add('preparing');
                    void next.offsetWidth;
                    next.classList.remove('preparing');
                    next.classList.add('active');
                    this.currentViewId = viewId;
                    this.updateMeta(viewId);
                    window.scrollTo(0,0);
                }
            }
            updateMeta(viewId) {
                const setMeta = (title, desc) => {
                    document.title = `${title} | ${Config.baseTitle}`;
                    document.querySelector('meta[name="description"]').setAttribute("content", desc);
                };
                switch(viewId) {
                    case 'view-foundation': setMeta("Foundation", Config.baseDesc); break;
                    case 'view-inter': setMeta("Intermediate", Config.baseDesc); break;
                    case 'view-final': setMeta("Final", Config.baseDesc); break;
                    case 'view-quiz': setMeta("Interactive Quiz", "Practice CMA MCQs with instant feedback."); break;
                    case 'view-about': setMeta("About Prepogy", "Learn about the mission behind Prepogy."); break;
                    default: setMeta("Home", Config.baseDesc);
                }
            }
            renderFoundation() {
                const container = document.getElementById('foundationList');
                if(container) container.innerHTML = Config.syllabus.foundation.map(p => this.createCard(p, 'card-foundation')).join('');
            }
            renderSubjects(key, title, theme) {
                document.getElementById('subjectsTitle').textContent = title;
                document.getElementById('subjectsList').innerHTML = Config.syllabus[key].map(p => this.createCard(p, theme)).join('');
                this.navigateTo('view-subjects');
            }
            createCard(p, theme) {
                return `<div class="subject-card ${theme} flex items-center gap-5 text-left p-6" onclick="App.selectPaper('${p.id}', '${p.t}')">
                    <div class="w-14 h-14 rounded-2xl bg-white/80 flex items-center justify-center shrink-0 text-2xl shadow-sm"><i class="fas ${p.i} ${p.c}"></i></div>
                    <div><h3 class="font-bold text-gray-800 text-sm md:text-base">${p.t}</h3><p class="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Practice Now</p></div>
                </div>`;
            }
        }

        class QuizManager {
            constructor() {
                this.state = { paperId: null, mode: null, currentSetIdx: 0, currentQIdx: 0, score: { c: 0, w: 0 }, dataSets: null, answers: [] };
                this.loader = document.getElementById('globalLoader');
                document.getElementById('btnNextQ').onclick = () => this.changeQuestion(1);
                document.getElementById('btnPrevQ').onclick = () => this.changeQuestion(-1);
                this.touchStartX = 0;
                this.touchStartY = 0;
                this.touchStartTime = 0;
                this.initGestures();
            }
            initGestures() {
                const area = document.getElementById('questionArea');
                area.addEventListener('touchstart', (e) => {
                    if (e.touches.length > 1) return;
                    this.touchStartX = e.changedTouches[0].clientX;
                    this.touchStartY = e.changedTouches[0].clientY;
                    this.touchStartTime = new Date().getTime();
                }, { passive: true });
                area.addEventListener('touchend', (e) => {
                    if (e.changedTouches.length !== 1) return;
                    const touch = e.changedTouches[0];
                    const diffX = this.touchStartX - touch.clientX;
                    const diffY = this.touchStartY - touch.clientY;
                    const duration = new Date().getTime() - this.touchStartTime;
                    if (duration < 500 && Math.abs(diffX) > 50 && Math.abs(diffX) > (Math.abs(diffY) * 1.5)) {
                        if (diffX > 0) this.changeQuestion(1); else this.changeQuestion(-1);
                    }
                }, { passive: true });
            }
            async startQuizSession(mode) {
                this.state.mode = mode;
                this.loader.classList.remove('hidden');
                this.loader.style.display = 'flex';
                const fileName = (mode === 'sjc') ? 'SJC COST CHAPTER WISE.js' : `${mode}${this.state.paperId}.js`;
                try {
                    const data = await this.loadFile(fileName);
                    this.state.dataSets = data;
                    this.setupSelector();
                    App.view.navigateTo('view-quiz');
                    this.loadSet(0);
                } catch (e) { console.error("Quiz load error", e); } finally {
                    this.loader.classList.add('hidden');
                    this.loader.style.display = 'none';
                }
            }
            loadFile(fileName) {
                return new Promise((resolve, reject) => {
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    document.body.appendChild(iframe);
                    const handler = (e) => {
                        if (e.source !== iframe.contentWindow) return;
                        if (e.data.type === 'SUCCESS') {
                            window.removeEventListener('message', handler);
                            iframe.remove();
                            resolve(e.data.payload);
                        } else if (e.data.type === 'ERROR') {
                            window.removeEventListener('message', handler);
                            iframe.remove();
                            reject();
                        }
                    };
                    window.addEventListener('message', handler);
                    const doc = iframe.contentWindow.document;
                    doc.open();
                    doc.write(`<html><body><script>function triggerSuccess(){if(typeof quizSets!=='undefined'){window.parent.postMessage({type:'SUCCESS',payload:JSON.parse(JSON.stringify(quizSets))},'*');}else{triggerError();}}function triggerError(){window.parent.postMessage({type:'ERROR'},'*');}<\/script><script src="${fileName}" onload="triggerSuccess()" onerror="triggerError()"><\/script></body></html>`);
                    doc.close();
                });
            }
            setupSelector() {
                const s = document.getElementById('setSelector');
                s.innerHTML = this.state.dataSets.map((set, i) => `<option value="${i}">${set.setName}</option>`).join('');
                s.onchange = (e) => this.loadSet(parseInt(e.target.value));
            }
            loadSet(idx) {
                this.state.currentSetIdx = idx;
                this.state.currentQIdx = 0;
                this.state.score = { c: 0, w: 0 };
                this.state.answers = new Array(this.state.dataSets[idx].questions.length).fill(null);
                document.getElementById('resultsArea').classList.add('hidden');
                document.getElementById('questionArea').classList.remove('hidden');
                this.updateUI();
                this.renderQuestion();
            }
            renderQuestion() {
                const q = this.state.dataSets[this.state.currentSetIdx].questions[this.state.currentQIdx];
                document.getElementById('qIndexDisplay').textContent = `Question ${this.state.currentQIdx + 1} / ${this.state.dataSets[this.state.currentSetIdx].questions.length}`;
                document.getElementById('qTextDisplay').textContent = q.q;
                const expBox = document.getElementById('explanationContainer');
                const container = document.getElementById('optionsContainer');
                container.innerHTML = q.o.map((opt, i) => {
                    const answered = this.state.answers[this.state.currentQIdx] !== null;
                    const selected = this.state.answers[this.state.currentQIdx] === opt;
                    const correct = opt === q.c;
                    let cls = "option";
                    if(answered) { cls += " disabled"; if(correct) cls += " correct"; else if(selected) cls += " incorrect"; }
                    return `<div class="${cls}" onclick="App.quiz.pick('${opt.replace(/'/g, "\\'")}')" role="button"><span class="w-9 h-9 rounded-lg bg-slate-100 flex items-center justify-center font-bold mr-4 shrink-0 text-slate-600">${String.fromCharCode(65+i)}</span><span class="text-sm font-medium text-slate-700">${opt}</span></div>`;
                }).join('');
                if(this.state.answers[this.state.currentQIdx] !== null) {
                    expBox.classList.remove('hidden');
                    document.getElementById('explanationText').textContent = q.explanation || "This question is based on concepts from the official CMA Syllabus 2022 modules.";
                } else { expBox.classList.add('hidden'); }
                document.getElementById('btnPrevQ').style.visibility = this.state.currentQIdx === 0 ? 'hidden' : 'visible';
                document.getElementById('btnNextQ').innerHTML = (this.state.currentQIdx === this.state.dataSets[this.state.currentSetIdx].questions.length - 1) ? 'Finish' : 'Next <i class="fas fa-arrow-right"></i>';
            }
            pick(val) {
                if(this.state.answers[this.state.currentQIdx]) return;
                this.state.answers[this.state.currentQIdx] = val;
                const correct = this.state.dataSets[this.state.currentSetIdx].questions[this.state.currentQIdx].c;
                if(val === correct) this.state.score.c++; else this.state.score.w++;
                this.updateUI();
                this.renderQuestion();
            }
            updateUI() {
                const total = this.state.score.c + this.state.score.w;
                document.getElementById('scoreCorrect').textContent = this.state.score.c;
                document.getElementById('scoreWrong').textContent = this.state.score.w;
                document.getElementById('scoreAcc').textContent = total > 0 ? Math.round((this.state.score.c/total)*100) + '%' : '0%';
            }
            changeQuestion(dir) {
                const total = this.state.dataSets[this.state.currentSetIdx].questions.length;
                const next = this.state.currentQIdx + dir;
                if (next < 0) return;
                if (next >= total) { this.finish(); return; }
                const area = document.getElementById('questionArea');
                area.classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    this.state.currentQIdx = next;
                    this.renderQuestion();
                    area.classList.remove('opacity-0', 'scale-95');
                }, 150);
            }
            finish() {
                document.getElementById('questionArea').classList.add('hidden');
                document.getElementById('resultsArea').classList.remove('hidden');
                document.getElementById('finalScoreDisplay').textContent = `Correct Answers: ${this.state.score.c} / ${this.state.dataSets[this.state.currentSetIdx].questions.length}`;
                document.getElementById('quoteDisplay').textContent = Config.quotes[Math.floor(Math.random() * Config.quotes.length)];
                this.bindShare();
            }
            bindShare() {
                const url = "https://prepogy.in";
                const msg = "I just scored " + this.state.score.c + " on Prepogy! üöÄ Practice CMA MCQs here: ";
                document.getElementById('btnShareWA').onclick = () => window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(msg + url)}`);
                document.getElementById('btnShareTG').onclick = () => window.open(`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(msg)}`);
                document.getElementById('btnShareCopy').onclick = () => {
                    const temp = document.createElement('input'); temp.value = url; document.body.appendChild(temp); temp.select(); document.execCommand('copy'); document.body.removeChild(temp);
                };
            }
            openGoogleSearchExplanation() {
                const q = this.state.dataSets[this.state.currentSetIdx].questions[this.state.currentQIdx];
                const query = `Explain why "${q.c}" is the correct answer for this CMA MCQ: \nQuestion: ${q.q}\nOptions: ${q.o.join(', ')}`;
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
            }
            resetLocalProgress() { this.loadSet(this.state.currentSetIdx); }
        }

        class PrepogyApp {
            constructor() {
                this.view = new ViewManager();
                this.quiz = new QuizManager();
                this.view.renderFoundation();
                document.getElementById('logoHome').onclick = () => this.view.resetToHome();
                document.getElementById('btnShortcuts').onclick = () => this.toggleShortcuts(true);
                document.addEventListener('keydown', (e) => this.handleKeys(e));
            }
            toggleShortcuts(show) { const el = document.getElementById('shortcutsModal'); if(show) el.classList.add('show'); else el.classList.remove('show'); }
            toggleSjcModal(show) { const el = document.getElementById('sjcIntroModal'); if(show) el.classList.add('show'); else el.classList.remove('show'); }
            selectPaper(id, title) {
                this.quiz.state.paperId = id;
                document.getElementById('dashTitle').textContent = title;
                const sjcCard = document.getElementById('cardSjc');
                const libCard = document.getElementById('cardLibrary');
                if (id == '8') { sjcCard.classList.remove('hidden'); libCard.classList.add('hidden'); } else { sjcCard.classList.add('hidden'); libCard.classList.remove('hidden'); }
                const pyqCard = document.querySelector('.mode-pyq');
                if (pyqCard) {
                    const numId = parseInt(id); 
                    const isInter = !isNaN(numId) && numId >= 5 && numId <= 12;
                    if (isInter) pyqCard.classList.remove('opacity-60', 'cursor-not-allowed', 'pointer-events-none');
                    else pyqCard.classList.add('opacity-60', 'cursor-not-allowed', 'pointer-events-none');
                }
                this.view.navigateTo('view-dashboard');
            }
            handleKeys(e) {
                if (this.view.currentViewId !== 'view-quiz' || !this.quiz.state.dataSets) return;
                const key = e.key.toLowerCase();
                const keyMap = { 'a': 0, 'b': 1, 'c': 2, 'd': 3, '1': 0, '2': 1, '3': 2, '4': 3 };
                if (key in keyMap) {
                    const qIdx = this.quiz.state.currentQIdx;
                    const question = this.quiz.state.dataSets[this.quiz.state.currentSetIdx].questions[qIdx];
                    if (question && question.o[keyMap[key]]) this.quiz.pick(question.o[keyMap[key]]);
                }
                if (key === 'arrowright' || key === 'enter') this.quiz.changeQuestion(1);
                if (key === 'arrowleft' || key === 'escape') { if(key === 'arrowleft') this.quiz.changeQuestion(-1); else this.view.goBack(); }
            }
        }
        const App = new PrepogyApp();
    </script>
</body>
</html>
